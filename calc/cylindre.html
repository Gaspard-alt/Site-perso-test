<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Volume - Cylindre</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 30px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            flex-wrap: wrap;
        }

        #canvas-container {
            flex: 1;
            min-width: 300px;
            height: 500px;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .controls {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 25px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .info-text {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            padding: 0;
            height: 8px;
            cursor: pointer;
        }

        .slider-value {
            min-width: 60px;
            text-align: right;
            color: #667eea;
            font-weight: 600;
        }

        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
        }

        .formula {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 10px;
        }

        .formula-text {
            color: #666;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }

        .unit-info {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }

            #canvas-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="canvas-container"></div>
        
        <div class="controls">
            <div>
                <h1>ðŸ’§ Volume Liquide</h1>
                <p class="info-text">Ajustez les paramÃ¨tres du cylindre et la hauteur du liquide</p>
            </div>

            <div class="control-group">
                <label for="radius">Rayon du cylindre (cm)</label>
                <div class="slider-container">
                    <input type="range" id="radius" min="1" max="20" value="5" step="0.1">
                    <span class="slider-value" id="radiusValue">5.0</span>
                </div>
            </div>

            <div class="control-group">
                <label for="height">Hauteur totale du cylindre (cm)</label>
                <div class="slider-container">
                    <input type="range" id="height" min="5" max="50" value="20" step="0.1">
                    <span class="slider-value" id="heightValue">20.0</span>
                </div>
            </div>

            <div class="control-group">
                <label for="liquidHeight">Hauteur du liquide (cm)</label>
                <div class="slider-container">
                    <input type="range" id="liquidHeight" min="0" max="20" value="10" step="0.1">
                    <span class="slider-value" id="liquidHeightValue">10.0</span>
                </div>
            </div>

            <div class="results">
                <div class="result-item">
                    <span class="result-label">Volume du liquide</span>
                    <span class="result-value" id="volume">785.40</span>
                </div>
                <div class="unit-info">cmÂ³ (millilitres)</div>

                <div class="result-item" style="margin-top: 10px;">
                    <span class="result-label">Pourcentage du cylindre</span>
                    <span class="result-value" id="percentage">50%</span>
                </div>

                <div class="formula">
                    <div class="formula-text">
                        <strong>Formule utilisÃ©e:</strong><br>
                        V = Ï€ Ã— rÂ² Ã— h<br>
                        <span id="calculation"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // === Configuration Three.js ===
        const canvas = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        const camera = new THREE.PerspectiveCamera(
            75,
            canvas.clientWidth / canvas.clientHeight,
            0.1,
            1000
        );
        camera.position.set(8, 12, 15);
        camera.lookAt(0, 5, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        renderer.shadowMap.enabled = true;
        canvas.appendChild(renderer.domElement);

        // === LumiÃ¨res ===
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 20, 10);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        scene.add(directionalLight);

        // === MatÃ©riaux ===
        const cylinderMaterial = new THREE.MeshStandardMaterial({
            color: 0x2c3e50,
            metalness: 0.3,
            roughness: 0.4
        });

        const liquidMaterial = new THREE.MeshStandardMaterial({
            color: 0x3498db,
            metalness: 0.5,
            roughness: 0.3,
            transparent: true,
            opacity: 0.8
        });

        // === GÃ©omÃ©trie du cylindre ===
        const cylinderGroup = new THREE.Group();
        scene.add(cylinderGroup);

        // Corps du cylindre
        const cylinderGeometry = new THREE.CylinderGeometry(1, 1, 1, 32);
        const cylinder = new THREE.Mesh(cylinderGeometry, cylinderMaterial);
        cylinder.castShadow = true;
        cylinder.receiveShadow = true;
        cylinderGroup.add(cylinder);

        // Bouchon supÃ©rieur
        const topGeometry = new THREE.CylinderGeometry(1, 1, 0.1, 32);
        const topCap = new THREE.Mesh(topGeometry, cylinderMaterial);
        topCap.position.y = 0.55;
        topCap.castShadow = true;
        topCap.receiveShadow = true;
        cylinderGroup.add(topCap);

        // Bouchon infÃ©rieur
        const bottomGeometry = new THREE.CylinderGeometry(1, 1, 0.1, 32);
        const bottomCap = new THREE.Mesh(bottomGeometry, cylinderMaterial);
        bottomCap.position.y = -0.55;
        bottomCap.castShadow = true;
        bottomCap.receiveShadow = true;
        cylinderGroup.add(bottomCap);

        // Liquide (gÃ©omÃ©trie dynamique)
        let liquidGeometry = new THREE.CylinderGeometry(1, 1, 0.5, 32);
        let liquid = new THREE.Mesh(liquidGeometry, liquidMaterial);
        liquid.position.y = -0.25;
        liquid.castShadow = true;
        liquid.receiveShadow = true;
        cylinderGroup.add(liquid);

        // === ContrÃ´les ===
        const radiusInput = document.getElementById('radius');
        const heightInput = document.getElementById('height');
        const liquidHeightInput = document.getElementById('liquidHeight');

        const radiusValue = document.getElementById('radiusValue');
        const heightValue = document.getElementById('heightValue');
        const liquidHeightValue = document.getElementById('liquidHeightValue');

        const volumeDisplay = document.getElementById('volume');
        const percentageDisplay = document.getElementById('percentage');
        const calculationDisplay = document.getElementById('calculation');

        function updateVisualization() {
            const radius = parseFloat(radiusInput.value);
            const totalHeight = parseFloat(heightInput.value);
            const liquidHeight = parseFloat(liquidHeightInput.value);

            // Mise Ã  jour des valeurs affichÃ©es
            radiusValue.textContent = radius.toFixed(1);
            heightValue.textContent = totalHeight.toFixed(1);
            liquidHeightValue.textContent = liquidHeight.toFixed(1);

            // Mise Ã  jour du cylindre principal
            cylinderGroup.children[0].scale.x = radius / 5;
            cylinderGroup.children[0].scale.z = radius / 5;
            cylinderGroup.children[0].scale.y = totalHeight / 20;

            // Mise Ã  jour des bouchons
            cylinderGroup.children[1].scale.x = radius / 5;
            cylinderGroup.children[1].scale.z = radius / 5;
            cylinderGroup.children[1].position.y = (totalHeight / 20) * 0.5 + 0.05;

            cylinderGroup.children[2].scale.x = radius / 5;
            cylinderGroup.children[2].scale.z = radius / 5;
            cylinderGroup.children[2].position.y = -(totalHeight / 20) * 0.5 - 0.05;

            // Correction pour l'index du liquide (maintenant Ã  l'index 3)
            if (cylinderGroup.children.length > 3) {
                cylinderGroup.remove(cylinderGroup.children[3]);
            }

            // Mise Ã  jour du liquide
            if (cylinderGroup.children.length > 3) {
                cylinderGroup.remove(liquid);
            }
            liquidGeometry.dispose();

            const liquidHeightScaled = Math.min(liquidHeight, totalHeight);
            liquidGeometry = new THREE.CylinderGeometry(1, 1, liquidHeightScaled / 20, 32);
            liquid = new THREE.Mesh(liquidGeometry, liquidMaterial);
            
            liquid.scale.x = radius / 5;
            liquid.scale.z = radius / 5;
            liquid.position.y = -(totalHeight / 40) + (liquidHeightScaled / 40);
            
            liquid.castShadow = true;
            liquid.receiveShadow = true;
            cylinderGroup.add(liquid);

            // Calcul du volume
            const volume = Math.PI * radius * radius * liquidHeight;
            const cylinderVolume = Math.PI * radius * radius * totalHeight;
            const percentage = (liquidHeight / totalHeight * 100).toFixed(1);

            volumeDisplay.textContent = volume.toFixed(2);
            percentageDisplay.textContent = `${percentage}%`;
            calculationDisplay.textContent = 
                `V = Ï€ Ã— ${radius.toFixed(1)}Â² Ã— ${liquidHeight.toFixed(1)} = ${volume.toFixed(2)} cmÂ³`;

            // Mise Ã  jour du slider de hauteur du liquide
            liquidHeightInput.max = totalHeight;
            if (liquidHeight > totalHeight) {
                liquidHeightInput.value = totalHeight;
            }
        }

        // Ã‰vÃ©nements
        radiusInput.addEventListener('input', updateVisualization);
        heightInput.addEventListener('input', updateVisualization);
        liquidHeightInput.addEventListener('input', updateVisualization);

        // === ContrÃ´les de souris ===
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let rotation = { x: 0, y: 0 };

        renderer.domElement.addEventListener('mousedown', (e) => {
            isDragging = true;
            previousMousePosition = { x: e.clientX, y: e.clientY };
        });

        renderer.domElement.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                rotation.y += deltaX * 0.01;
                rotation.x += deltaY * 0.01;

                previousMousePosition = { x: e.clientX, y: e.clientY };
            }
        });

        renderer.domElement.addEventListener('mouseup', () => {
            isDragging = false;
        });

        renderer.domElement.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Initialisation
        updateVisualization();

        // === Animation ===
        function animate() {
            requestAnimationFrame(animate);
            
            // Application de la rotation contrÃ´lÃ©e par la souris
            cylinderGroup.rotation.x = rotation.x;
            cylinderGroup.rotation.y = rotation.y;
            
            renderer.render(scene, camera);
        }
        animate();

        // === Gestion du redimensionnement ===
        window.addEventListener('resize', () => {
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        });
    </script>
</body>
</html>
